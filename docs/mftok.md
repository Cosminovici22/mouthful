# Mftok

Mftok tokenizes text using a lexer generated by mfgen. It is both an API and a
command line utility.

## CLI Utility Usage

```
mftok <lexer_dump> <file>
```

Parameter `lexer_dump` is a dump of a lexer previously generated by mfgen.

Parameter `file` is an ASCII encoded text file whose contents are to be
tokenized.

## API Usage

```
#include "include/mftok.h"

struct mflexer { /* ... */ };

int mflexer_init(struct mflexer *lexer, FILE *file);
void mflexer_destroy(struct mflexer *lexer);
int mflexer_tokenize_stream(const struct mflexer *lexer, FILE *file);
int mflexer_tokenize_string(const struct mflexer *lexer, const char *string
	, size_t *offset);
```

The `mflexer_init()` function initializes a lexer from a dump generated by
`mfgen`. Failure to initialize is guaranteed to not leave any resources
allocated. Argument `lexer` must point to a preallocated `struct mflexer`.
Argument `file` must point to the `FILE` of a lexer dump generated by mfgen.
Function returns `MFSTATUS_SUCCESS` uppon successful completion,
`MFSTATUS_ERR_IO` in case of I/O errors or `MFSTATUS_ERR_MEM` in case of
allocation errors.

Function `mflexer_destroy()` frees any resources held by the given lexer.
Argument `lexer` must point to a `struct mflexer` initialized with
`mflexer_init()`.

Function `mflexer_tokenize_stream()` extracts one token from an input stream,
according to the given lexer. File position indicator is moved to the end of the
identified token. If an invalid token is encountered, the file position
indicator is not advanced. Function is not responsible for reporting EOF,
however I/O errors are reported. Argument `lexer` must point to a
`struct mflexer` initialized with `mflexer_init()`. Argument `file` must point
to the stream to be tokenized. Function returns the type of the identified
token, `MFSTATUS_INVALID` in case of an invalid token or EOF, `MFSTATUS_ERR_IO`
in case of I/O errors

Function `mflexer_tokenize_string()` extracts one token from an input string,
starting from `offset`, according to the given lexer. Value pointed to by
`offset` is set to the end of the identified token. If an invalid token is
encountered, the offset is not advanced. Function is not responsible for
reporting the end of the string. Argument `lexer` points to a `struct mflexer`
initialized with `mflexer_init()`. Argument `string` is the string to be
tokenized, ending with `\0`, Argument `offset` points to a position relative to
the beginning of `string`. Function returns the type of the identified token,
`MFSTATUS_INVALID` in case of an invalid token or end of string.

Possible status codes:
- `MFSTATUS_SUCCESS`: signals the successful execution of a function
- `MFSTATUS_ERR_TOK`: signals the presence of a non-token in the input
- `MFSTATUS_ERR_IO`: signals an I/O error
- `MFSTATUS_ERR_MEM`: signals an allocation error

Example of API usage is available inside `main()` function of `src/mftok.c`
